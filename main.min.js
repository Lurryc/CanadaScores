var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),game;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.m_aImages=[],t.m_bMove=!1,t.m_nSpeed=1,t.m_bUp=!1,t.m_nAimNumber=-1,t.skinName="resource/NumComp.exml?v="+Main.fGetIns().m_nVersion,t.once(eui.UIEvent.COMPLETE,t.fOnUICreate,t),t.m_bUp=!1,t.m_bMoveFinish=!1,t.m_nAimNumber=-1,t}return __extends(t,e),t.prototype.fInit=function(){this.m_nSpeed=1,this.m_bUp=!1,this.m_bMoveFinish=!1,this.m_bMove=!1,this.m_nAimNumber=-1,this.m_aImages=[],this.m_aImages.push(this.m_img0),this.m_aImages.push(this.m_img1),this.m_aImages.push(this.m_img2),this.m_aImages.push(this.m_img3),this.m_img0.y=0,this.m_img1.y=75,this.m_img2.y=150,this.m_img3.y=225},t.prototype.fOnUICreate=function(){this.fInit()},t.prototype.fSetMove=function(e){void 0===e&&(e=1),this.addEventListener(egret.Event.ENTER_FRAME,this.fEnterFrame,this),this.m_bMove=!0,this.m_nSpeed=e},t.prototype.fEnterFrame=function(){if(4.1==this.m_nSpeed&&this.m_aImages[0].y<=-70&&this.m_aImages[0].y>=-80&&this.m_aImages[2].source=="num_num"+this.m_nAimNumber+"_png"){var e=-75-this.m_aImages[0].y;return this.m_aImages[0].y=-75,this.m_aImages[1].y+=e,this.m_aImages[2].y+=e,this.m_aImages[3].y+=e,this.m_bMoveFinish=!0,void this.removeEventListener(egret.Event.ENTER_FRAME,this.fEnterFrame,this)}if(1==this.m_bMove)if(1==this.m_bUp?(this.m_img0.y-=this.m_nSpeed,this.m_img1.y-=this.m_nSpeed,this.m_img2.y-=this.m_nSpeed,this.m_img3.y-=this.m_nSpeed):(this.m_img0.y+=this.m_nSpeed,this.m_img1.y+=this.m_nSpeed,this.m_img2.y+=this.m_nSpeed,this.m_img3.y+=this.m_nSpeed),1==this.m_bUp){if(this.m_aImages[0].y<-75){this.m_aImages.push(this.m_aImages[0]),this.m_aImages.splice(0,1);var t=this.m_aImages[2].source.replace(/[^0-9]/gi,"");t=parseInt(t),9>t?t++:t=0,this.m_aImages[3].y=this.m_aImages[2].y+75,this.m_aImages[3].source="num_num"+t+"_png"}}else if(this.m_aImages[3].y>215){this.m_aImages.splice(0,0,this.m_aImages[3]),this.m_aImages.splice(4,1),this.m_aImages[0].y=this.m_aImages[1].y-75;var t=this.m_aImages[1].source.replace(/[^0-9]/gi,"");t=parseInt(t),t>=1?t--:t=9,this.m_aImages[0].source="num_num"+t+"_png"}},t}(eui.Component);e.NumComp=t,__reflect(t.prototype,"game.NumComp")}(game||(game={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?n(o):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.m_nVersion="1.00",t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.fGetIns=function(){return t.s_Main},t.prototype.createChildren=function(){e.prototype.createChildren.call(this),t.s_Main=this,egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){new game.NumComp;var e=new game.MainStopScene;this.addChild(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,n=e.map(function(e){return i.parse(e)}),o=this.textfield,s=-1,r=function(){s++,s>=n.length&&(s=0);var e=n[s];o.textFlow=e;var i=egret.Tween.get(o);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,t)};r()},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var game;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.m_aResult=[],i.m_aStopPosition=[],i.m_sNextPeriod="",i.m_sCurrentPeriod="",i.m_nRemainDrawTime=0,i.m_nRemainBetTime=0,i.m_nServerErrorCount=0,i.C_IMGHEIGHT=900,i.C_GROUPHEIGHT=89,i.m_nMoveCount=0,i.m_nStopIndex=0,i.m_bLottery=!1,i.m_oTimer=null,i.m_nLastUpdateTime=0,i.m_nUpdateTimeCount=0,i.skinName="resource/MainStopScene.exml",i.addEventListener(eui.UIEvent.COMPLETE,i.fOnUICreate,i),"iOS"!=egret.Capabilities.os&&(e.SoundManager.fGetIns().fLoadBgMusic("bg_mp3"),e.SoundManager.fGetIns().fSetVoiceStatus(!1)),i}return __extends(i,t),i.prototype.fOnUICreate=function(){this.m_gopMask.mask=new egret.Rectangle(0,0,481,35);var e=egret.Tween.get(this.m_labTip,{loop:!0});e.to({x:100-this.m_labTip.width},6200).to({x:601},0),this.fGetDataAlways(),this.addEventListener(egret.Event.ENTER_FRAME,this.fUpdate,this),this.m_nLastUpdateTime=(new Date).getTime(),this.m_imgSoundOpen.visible=!1,this.m_imgSoundClose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fOnClick,this),this.m_imgSoundOpen.addEventListener(egret.TouchEvent.TOUCH_TAP,this.fOnClick,this),this.m_gopNum0.mask=new egret.Rectangle(0,-8,33,74),this.m_gopNum1.mask=new egret.Rectangle(0,-8,33,74),this.m_gopNum2.mask=new egret.Rectangle(0,-8,33,74),this.m_gopNum3.mask=new egret.Rectangle(0,-8,33,74),this.m_gopNum4.mask=new egret.Rectangle(0,-8,33,74)},i.prototype.fOnClick=function(t){(t.target==this.m_imgSoundOpen||t.target==this.m_imgSoundClose)&&(this.m_imgSoundOpen.visible=!this.m_imgSoundOpen.visible,this.m_imgSoundClose.visible=!this.m_imgSoundClose.visible,e.SoundManager.fGetIns().fSetVoiceStatus(this.m_imgSoundOpen.visible))},i.prototype.fGetDataAlways=function(){e.GameHttpManager.fGetBJRacingData(this.fGetDataBack,this)},i.prototype.fGetDataBack=function(e){for(var t=e.current.awardNumbers.split(","),i=0;i<t.length;i++)this.m_aResult[i]=parseInt(t[i]);if(this.m_sNextPeriod==e.current.periodNumber)this.m_labTime.visible=!0,this.m_labTipKaiJiang.visible=!1,this.fEndGame(this.m_aResult),console.info("出结果");else if(parseInt(e.next.periodNumber)-parseInt(e.current.periodNumber)!=1){if(this.m_nServerErrorCount++,console.info("服务器数据错误"),this.m_nServerErrorCount<10)return this.m_nRemainDrawTime=6e3,this.m_labQishu.text=e.current.periodNumber,this.m_labQishuNext.text=e.next.periodNumber,this.m_labKaijiang.text=e.next.drawTime,this.fSetTopNumber(this.m_aResult),this.fSetNumber(),void this.fSetFoot(e.current.propertyNumbers);console.info("强制停止"),null!=this.m_oTimer&&this.m_oTimer.stop(),this.m_oTimer=null,this.m_labTipKaiJiang.visible=!1,this.m_labTime.visible=!0,this.m_nServerErrorCount=0}this.m_nRemainBetTime=1e3*e.next.remainBetTime,this.m_nRemainDrawTime=1e3*e.next.remainDrawTime,this.m_nRemainDrawTime+=6e3,this.m_sNextPeriod=e.next.periodNumber,this.m_sCurrentPeriod=e.current.periodNumber,this.m_labQishu.text=this.m_sCurrentPeriod,this.m_labQishuNext.text=this.m_sNextPeriod,this.m_labKaijiang.text=e.next.drawTime,this.m_oDanShuangDaXiao=e.current.propertyNumbers,0==this.m_bLottery&&(this.fSetTopNumber(this.m_aResult),this.fSetNumber(),this.fSetFoot(e.current.propertyNumbers)),e.next.remainBetTime>0?(this.m_nServerErrorCount=0,this.m_labTime.text=this.fSecondToTime(Math.floor(this.m_nRemainBetTime/1e3)),console.info("还未开始比赛")):e.next.remainBetTime<=0&&(""!=this.m_sNextPeriod?(console.info("开始比赛，播放动画"),this.fBeginGame(),this.m_labTime.visible=!1,this.m_labTipKaiJiang.visible=!0):console.info("显示正在开奖"))},i.prototype.fSetTopNumber=function(e){for(var t=0;t<e.length;t++)this["m_imgTopNum"+t].source="num_num"+e[t]+"_png"},i.prototype.fSetNumber=function(){this.fSavePosByResult();for(var e=0;e<this.m_aStopPosition.length;e++){var t=this["m_gopNum"+e],i=t.getChildByName("up"),n=t.getChildByName("down");this.m_aStopPosition[e]>-this.C_IMGHEIGHT/2?(n.y=this.m_aStopPosition[e],i.y=n.y-this.C_IMGHEIGHT):(n.y=this.m_aStopPosition[e],i.y=n.y+this.C_IMGHEIGHT)}},i.prototype.fSetFoot=function(e){for(var t=1;5>=t;t++)this["m_labBallUp"+t].text=e["ball"+t+"_ds"],this["m_labBallDown"+t].text=e["ball"+t+"_dx"]},i.prototype.fBeginGame=function(){null==this.m_oTimer&&(this.m_oTimer=new egret.Timer(10,0),this.m_oTimer.addEventListener(egret.TimerEvent.TIMER,this.fRun,this),this.m_oTimer.start())},i.prototype.fRun=function(){for(var e=0;4>=e;e++){var t=this["m_gopNum"+e],i=t.getChildByName("up"),n=t.getChildByName("down");i.y+=15+3*e,n.y+=15+3*e,i.y>=this.C_GROUPHEIGHT&&(i.y=n.y-this.C_IMGHEIGHT),n.y>=this.C_GROUPHEIGHT&&(n.y=i.y-this.C_IMGHEIGHT)}},i.prototype.fEndGame=function(e){this.m_bLottery=!0,null!=this.m_oTimer&&this.m_oTimer.stop(),this.fSavePosByResult(),this.m_oTimer=new egret.Timer(10,0),this.m_oTimer.addEventListener(egret.TimerEvent.TIMER,this.fStop,this),this.m_oTimer.start()},i.prototype.fStop=function(){this.m_nMoveCount++;for(var e=0;4>=e;e++)if(!(e<=this.m_nStopIndex)){var t=this["m_gopNum"+e],i=t.getChildByName("up"),n=t.getChildByName("down");i.y+=10+2*e,n.y+=10+2*e,i.y>=this.C_GROUPHEIGHT&&(i.y=n.y-this.C_IMGHEIGHT),n.y>=this.C_GROUPHEIGHT&&(n.y=i.y-this.C_IMGHEIGHT)}for(var e=0;4>=e;e++)if(this.m_nStopIndex==e){var t=this["m_gopNum"+e],i=t.getChildByName("up"),n=t.getChildByName("down");if(i.y+=5,n.y+=5,i.y>=this.C_GROUPHEIGHT&&(i.y=n.y-this.C_IMGHEIGHT),n.y>=this.C_GROUPHEIGHT&&(n.y=i.y-this.C_IMGHEIGHT),this.m_nMoveCount>50){var o=null,s=null;if(n.y>=this.m_aStopPosition[e]-3&&n.y<=this.m_aStopPosition[e]+3?(o=n,s=i):i.y>=this.m_aStopPosition[e]-3&&i.y<=this.m_aStopPosition[e]+3&&(o=i,s=n),null!=o){var r=this.m_aStopPosition[e]-o.y;o.y=this.m_aStopPosition[e],s.y+=r,this.m_nMoveCount=0,4==this.m_nStopIndex?(this.m_nStopIndex=0,this.m_oTimer.stop(),this.m_oTimer=null,this.m_bLottery=!1,this.fSetTopNumber(this.m_aResult),this.fSetFoot(this.m_oDanShuangDaXiao)):this.m_nStopIndex++}}break}},i.prototype.fSavePosByResult=function(){this.m_aStopPosition.length=0;for(var e=0;e<this.m_aResult.length;e++)this.m_aStopPosition.push(-this.C_IMGHEIGHT/10*this.m_aResult[e])},i.prototype.fUpdate=function(){var e=(new Date).getTime()-this.m_nLastUpdateTime;this.m_nLastUpdateTime=(new Date).getTime(),this.m_nUpdateTimeCount+=e,this.m_nUpdateTimeCount>1e3&&(this.fUpdateBetTime(this.m_nUpdateTimeCount),this.fUpdateDrawTime(this.m_nUpdateTimeCount),this.m_nUpdateTimeCount=0)},i.prototype.fUpdateDrawTime=function(e){this.m_nRemainDrawTime<0||(this.m_nRemainDrawTime-=e,this.m_nRemainDrawTime<=0&&this.fGetDataAlways())},i.prototype.fUpdateBetTime=function(e){this.m_nRemainBetTime<0||(this.m_nRemainBetTime-=e,this.m_labTime.text=this.fSecondToTime(Math.floor(this.m_nRemainBetTime/1e3)),(this.m_nRemainBetTime<=0||Math.floor(this.m_nRemainBetTime/1e3)%30==0)&&this.fGetDataAlways())},i.prototype.fDrawProgress=function(e){var t=new egret.Shape;this.m_gopHourMeter.addChild(t),t.graphics.clear(),t.graphics.lineStyle(8,13712438),t.graphics.drawArc(43,43,40,-Math.PI/2,2*Math.PI*e-Math.PI/2),t.graphics.endFill()},i.prototype.fIntoTwoDigits=function(e){return 10>e?"0"+e:""+e},i.prototype.fSecondToTime=function(e){if(0>=e)return"00:00";var t="";return t+=this.fIntoTwoDigits(Math.floor(e/60)),t+=":",t+=this.fIntoTwoDigits(e%60)},i}(eui.Component);e.MainStopScene=t,__reflect(t.prototype,"game.MainStopScene")}(game||(game={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function o(e){t.call(n,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var game;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/TopScene.exml?v="+Main.fGetIns().m_nVersion,t.once(eui.UIEvent.COMPLETE,t.fOnUICreate,t),t}return __extends(t,e),t.prototype.fOnUICreate=function(){},t.prototype.fSetNumer=function(e){for(var t=0;t<e.length;t++){var i=this.m_gopNumber.getChildByName("img"+t);i.source="num_num"+e[t]+"_png"}},t}(eui.Component);e.TopScene=t,__reflect(t.prototype,"game.TopScene")}(game||(game={}));var game;!function(e){var t=function(){function t(){}return t.fGetBJRacingData=function(i,n){var o=t.s_sAddress+"api/dong_hua_sdk?lottery_id=6",s={};e.GameHttpRequest.request(o,s,i,n,0,!1)},t.s_sAddress="http://mall.emba100.com/",t}();e.GameHttpManager=t,__reflect(t.prototype,"game.GameHttpManager")}(game||(game={}));var game;!function(e){var t=function(){function e(){}return e.request=function(t,i,n,o,s,r){void 0===s&&(s=1),void 0===r&&(r=!0),e.requestWithSign(t,i,n,o,s,r)},e.requestWithSign=function(t,i,n,o,s,r){void 0===s&&(s=1),void 0===r&&(r=!0);var a=new egret.URLLoader,m=new egret.URLRequest;m.url=t;var h=new egret.URLVariables;if(h.variables=i,1==s?m.data=JSON.stringify(i):m.data=h,1==s?m.method=egret.URLRequestMethod.POST:m.method=egret.URLRequestMethod.GET,a.addEventListener(egret.Event.COMPLETE,function(t){if(a.data){var i=JSON.parse(a.data);e.handleServerResult(i,o,n)}},this),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){},this),r){var u=new egret.URLRequestHeader("Content-Type","application/json;charset=UTF-8");m.requestHeaders=[u]}a.load(m)},e.handleServerResult=function(e,t,i){e||console.error("无数据返回!"),i&&i.call(t,e)},e.index=0,e}();e.GameHttpRequest=t,__reflect(t.prototype,"game.GameHttpRequest")}(game||(game={}));var game;!function(e){var t=function(){function e(){this.m_oBgSound=null,this.m_oBgSoundChannel=null,this.m_nBgVolume=.7,this.m_oCarSound=null,this.m_oCarSoundChannel=null,this.m_nCarVolume=.7,this.m_bFirstPress=!1}return e.fGetIns=function(){return null==e.s_Ins&&(e.s_Ins=new e),e.s_Ins},e.prototype.fSetVoiceStatus=function(t){0==t?(null!=this.m_oCarSound&&null!=this.m_oCarSoundChannel&&(this.m_oCarSoundChannel.volume=0),null!=this.m_oBgSound&&null!=this.m_oBgSoundChannel&&(this.m_oBgSoundChannel.volume=0),this.m_nBgVolume=this.m_nCarVolume=0):0==this.m_bFirstPress&&"iOS"==egret.Capabilities.os?(this.m_nBgVolume=this.m_nCarVolume=.7,e.fGetIns().fLoadBgMusic("bg_mp3"),this.m_bFirstPress=!0):(this.m_nBgVolume=this.m_nCarVolume=.7,null!=this.m_oCarSound&&null!=this.m_oCarSoundChannel&&(this.m_oCarSoundChannel.volume=this.m_nCarVolume),null!=this.m_oBgSound&&null!=this.m_oBgSoundChannel&&(this.m_oBgSoundChannel.volume=this.m_nBgVolume))},e.prototype.fLoadCarMusic=function(e){this.m_oCarSound=null,null!=this.m_oCarSoundChannel&&(this.m_oCarSoundChannel.stop(),this.m_oCarSoundChannel=null),this.m_oCarSound=RES.getRes(e),void 0!=this.m_oCarSound&&null!=this.m_oCarSound&&(this.m_oCarSoundChannel=this.m_oCarSound.play(0,0),this.m_oCarSoundChannel.volume=this.m_nCarVolume)},e.prototype.fStopCarMusic=function(){null!=this.m_oCarSoundChannel&&(this.m_oCarSoundChannel.stop(),this.m_oCarSoundChannel=null,this.m_oCarSound=null)},e.prototype.fLoadBgMusic=function(e){this.m_oBgSound=null,null!=this.m_oBgSoundChannel&&(this.m_oBgSoundChannel.stop(),this.m_oBgSoundChannel=null),this.m_oBgSound=RES.getRes(e),void 0!=this.m_oBgSound&&null!=this.m_oBgSound&&(this.m_oBgSoundChannel=this.m_oBgSound.play(0,0),this.m_oBgSoundChannel.volume=this.m_nBgVolume)},e.prototype.fStop=function(){null!=this.m_oBgSoundChannel&&(this.m_oBgSoundChannel.stop(),this.m_oBgSoundChannel=null,this.m_oBgSound=null),null!=this.m_oCarSoundChannel&&(this.m_oCarSoundChannel.stop(),this.m_oCarSoundChannel=null,this.m_oCarSound=null)},e.s_Ins=null,e}();e.SoundManager=t,__reflect(t.prototype,"game.SoundManager")}(game||(game={}));